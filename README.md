**Описание структуры и систем проекта**

**Общая архитектура**

Проект построен на Unity с использованием мультиплеерного фреймворка Photon Fusion и системы внедрения зависимостей Zenject.
Вся логика разделена на сервисы, состояния, менеджеры и отдельные компоненты для удобства поддержки и расширения.

**Основные директории и их назначение**
 - CodeBase/ — основная папка с исходным кодом.
 - Gameplay/ — игровая логика, игроки, камера, состояния, компоненты персонажа.
 - Infrastructure/ — инфраструктурные сервисы, загрузка сцен, DI-установщики, стейт-машина.
 - Services/ — сервисы для работы с сетью, вводом, логированием, спавном игроков и др.
 - UI/ — пользовательский интерфейс (экраны, HUD, сообщения).
 - Plugins/ — сторонние библиотеки (Zenject, Fusion и др.).

**Ключевые системы**
 1) Мультиплеер (Photon Fusion)
    - Используется для синхронизации состояния игроков, передачи ввода и управления объектами.
    - Основные классы:
      - NetworkPlayer — сетевой игрок, управляемый через Fusion.
      - NetworkCallbacks — обработка сетевых событий (подключение, отключение, ввод, загрузка сцен и др.).
      - PlayerSpawner — отвечает за спавн и удаление игроков в сети.
2) Внедрение зависимостей (Zenject)
   - Все сервисы и основные компоненты регистрируются через Zenject-установщики.
   - Используется для удобного управления зависимостями и тестируемости кода.
   - Примеры:
     - BootstrapInstaller, GameplayInstaller — регистрируют сервисы и компоненты для разных стадий игры.
3) Система сообщений (Event Bus)
   - Для обмена событиями между системами используется IMessageService.
   - Примеры сообщений:
     - PlayerConnectedMessage, PlayerDisconnectedMessage, SceneLoadedMessage, HostDisconnectMessage.
4) Система состояний (State Machine)
   - Управляет переходами между состояниями игры (меню, загрузка, игровой процесс и др.).
   - Классы:
     - GameStateMachine — основная стейт-машина игры.
     - GameMenuState, GameLoadingState, GameLoopState — отдельные состояния.
5) Система спавна игроков
   - PlayerSpawner — слушает события о подключении игроков, загрузке сцен и готовности точек спавна.
   - Спавнит NetworkPlayer с нужным InputAuthority.
   - Удаляет персонажа при дисконнекте.
6) Система ввода
   - InputReader, NetworkInputService — обрабатывают локальный ввод и отправляют его в Fusion.
   - Ввод активируется только для локального игрока.
7) UI и HUD
   - UI создаётся через UIFactory и управляется через сервисы.
   - HUD и другие элементы активируются только для локального игрока.
8) Логирование
   - ILogService — централизованное логирование для отладки и мониторинга.
  
**Взаимодействие систем**
 - NetworkCallbacks принимает события от Fusion и рассылает их через IMessageService.
 - PlayerSpawner реагирует на сообщения и управляет жизненным циклом игроков.
 - GameStateMachine управляет переходами между состояниями (например, при дисконнекте хоста — переход в меню).
 - InputReader и NetworkInputService обеспечивают корректную работу ввода только для локального игрока.
 - UI и HUD активируются только для игрока с InputAuthority.

**Пример жизненного цикла игрока**
 - Игрок подключается — NetworkCallbacks вызывает PlayerConnectedMessage.
 - PlayerSpawner ловит событие, спавнит NetworkPlayer, внедряет зависимости, вызывает Initialize.
 - Ввод активируется только для локального игрока.
 - При дисконнекте — NetworkCallbacks вызывает DespawnPlayer, персонаж удаляется.
 - При выходе хоста — все клиенты переходят в меню.
